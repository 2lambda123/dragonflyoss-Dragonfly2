# Dragonfly Daemon Internals

## Architecture

```
                    ┌────────────────┐ ┌────────────────┐ ┌────────────────┐                      
                    │                │ │                │ │                │                      
                    │     Manager    │ │   Scheduler    │ │  CDN Service   │                      
                    │                │ │                │ │                │                      
                    └────────────────┘ └────────────────┘ └────────────────┘                      
                  ┌────────────┬─────────────────────────────────────────────┐                    
                  │  dfdaemon  │                                             │                    
                  ├────────────┘                                             │                    
┌───────────────┐ │ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ │  ┌────────────────┐
│               │ │ │                │ │                │ │                │ │  │                │
│  File Client  │ │ │Download Service│ │PeerTask Service│ │ Picec Service  │ │  │  Sync Service  │
│               │ │ │                │ │                │ │                │ │  │                │
└───────────────┘ │ └────────────────┘ └────────────────┘ └────────────────┘ │  └────────────────┘
┌───────────────┐ │ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ │                    
│               │ │ │                │ │                │ │                │ │                    
│ Proxy Client  │ │ │ Upload Service │ │Control Service │ │   GC Service   │ │                    
│               │ │ │                │ │                │ │                │ │                    
└───────────────┘ │ └────────────────┘ └────────────────┘ └────────────────┘ │                    
                  │ ┌────────────────┐                                       │                    
                  │ │                │                                       │                    
                  │ │Storage Service │                                       │                    
                  │ │                │                                       │                    
                  │ └────────────────┘                                       │                    
                  ├──────────────────────────────────────────────────────────┤                    
                  │ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ │                    
                  │ │ Local Storage  │ │ Memory Storage │ │     ......     │ │                    
                  │ └────────────────┘ └────────────────┘ └────────────────┘ │                    
                  └──────────────────────────────────────────────────────────┘                    
```

## Logic

```
          ┌──────────────────┬──────────────────────────────────────────┐                                  
          │     PeerHost     │                                          │                                  
          ├──────────────────┘                                          │                                  
          │    ┌─────────────────────┐       ┌─────────────────────┐    │      ┌─────────────────────┐     
 Download │    │   DownloadManager   │       │   PeerTaskManager   │    │      │                     │     
  Request │    ├─────────────────────┤       ├─────────────────────┤    │      │                     │     
──────────┼───▶│      Download       │◀─────▶│  RegisterPeerTask   │◀───┼─────▶│                     │     
──────────┼───▶│      Proxy          │       │  PullPieceTasks     │◀───┼─────▶│      Scheduler      │◀───┐
   Proxy  │    │                     │       │  ├─SendPiecePackage ├──┐ │      │                     │    │
  Request │    │                     │    ┌─▶│  └─ReportPieceState │  │ │      │                     │    │
          │    │                     │  ┌─┼─▶│  PeerTaskGC         │  │ │      │                     │    │
          │    └─────────────────────┘  │ │  └─────────────────────┘  │ │      └─────────────────────┘    │
          │                             │ │                           │ │                                 │
          │                             │ │                           │ │                                 │
          │    ┌─────────────────────┐  │ │  ┌─────────────────────┐  │ │      ┌─────────────────────┐    │
          │    │      GCManager      │  │ │  │     PicecManager    │  │ │      │                     │    │
          │    ├─────────────────────┤  │ │  ├─────────────────────┤  │ │      │                     │    │
          │    │      PeerTaskGC     ├──┘ └──┤    DownloadPiece    │◀─┘ Pull   │                     │    │
          │    │      PieceGC        │       │    UploadPiece      │────┼─────▶│       PeerHost      │    │
          │    │      TaskGC         ├──────▶│    ReportPiece      │   Piece   │                     │    │
          │    │      PeerHostGC     │       │    PieceGC          │    │      │                     │    │
          │    │                     │       │                     │    │      │                     │    │
          │    └──────────┬──────────┘       └─────────────────────┘    │      └─────────────────────┘    │
          │               │                                             │                                 │
          │               └─────────────────────────────────────────────┼─────────────────────────────────┘
          │                                                             │                                  
          └─────────────────────────────────────────────────────────────┘                                  s
```

## Glossary

## Components
