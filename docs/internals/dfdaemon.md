# Dragonfly Daemon Internals

## Architecture

```
                    ┌────────────────┐ ┌────────────────┐ ┌────────────────┐                      
                    │                │ │                │ │                │                      
                    │     Manager    │ │   Scheduler    │ │  CDN Service   │                      
                    │                │ │                │ │                │                      
                    └────────────────┘ └────────────────┘ └────────────────┘                      
                  ┌────────────┬─────────────────────────────────────────────┐                    
                  │  dfdaemon  │                                             │                    
                  ├────────────┘                                             │                    
┌───────────────┐ │ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ │  ┌────────────────┐
│               │ │ │                │ │                │ │                │ │  │                │
│  File Client  │ │ │Download Service│ │PeerTask Service│ │ Picec Service  │ │  │  Sync Service  │
│               │ │ │                │ │                │ │                │ │  │                │
└───────────────┘ │ └────────────────┘ └────────────────┘ └────────────────┘ │  └────────────────┘
┌───────────────┐ │ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ │                    
│               │ │ │                │ │                │ │                │ │                    
│ Proxy Client  │ │ │Storage Service │ │Control Service │ │   GC Service   │ │                    
│               │ │ │                │ │                │ │                │ │                    
└───────────────┘ │ └────────────────┘ └────────────────┘ └────────────────┘ │                    
                  │                                                          │                    
                  └──────────────────────────────────────────────────────────┘                    
                  ┌──────────────────────────────────────────────────────────┐                    
                  │ ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ │                    
                  │ │ Local Storage  │ │ Memory Storage │ │     ......     │ │                    
                  │ └────────────────┘ └────────────────┘ └────────────────┘ │                    
                  └──────────────────────────────────────────────────────────┘                    
```

## Logic

```
          ┌──────────────────┬──────────────────────────────────────────┐                                  
          │     PeerHost     │                                          │                                  
          ├──────────────────┘                                          │                                  
          │    ┌─────────────────────┐       ┌─────────────────────┐    │      ┌─────────────────────┐     
 Download │    │   DownloadManager   │       │   PeerTaskManager   │    │      │                     │     
  Request │    ├─────────────────────┤       ├─────────────────────┤    │      │                     │     
──────────┼───▶│      Download       │◀─────▶│  RegisterPeerTask   │◀───┼─────▶│                     │     
──────────┼───▶│      Proxy          │       │  PullPieceTasks     │◀───┼─────▶│      Scheduler      │◀───┐
   Proxy  │    │                     │       │  ├─SendPiecePackage ├──┐ │      │                     │    │
  Request │    │                     │    ┌─▶│  └─ReportPieceState │  │ │      │                     │    │
          │    │                     │  ┌─┼─▶│  PeerTaskGC         │  │ │      │                     │    │
          │    └─────────────────────┘  │ │  └─────────────────────┘  │ │      └─────────────────────┘    │
          │                             │ │                           │ │                                 │
          │                             │ │                           │ │                                 │
          │    ┌─────────────────────┐  │ │  ┌─────────────────────┐  │ │      ┌─────────────────────┐    │
          │    │      GCManager      │  │ │  │     PicecManager    │  │ │      │                     │    │
          │    ├─────────────────────┤  │ │  ├─────────────────────┤  │ │      │                     │    │
          │    │                     ├──┘ └──┤    DownloadPiece    │◀─┘ │      │                     │    │
          │    │      PeerTaskGC     │       │    UploadPiece      │────Pull──▶│       PeerHost      │    │
          │    │      PieceGC        ├──────▶│    ReportPiece      │   Piece   │                     │    │
          │    │      PeerHostGC     │       │    PieceGC          │    │      │                     │    │
          │    │                     │       │                     │    │      │                     │    │
          │    └──────────┬──────────┘       └─────────────────────┘    │      └─────────────────────┘    │
          │               │                                             │                                 │
          │               └─────────────────────────────────────────────┼─────────────────────────────────┘
          │                                                             │                                  
          └─────────────────────────────────────────────────────────────┘                                  
```

## Glossary

## Components
